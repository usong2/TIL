# 디자인 시스템

## 01. 비주얼 테스트로 더 쉽게 개발하기

요즘 대부분의 웹 사이트들은 상황에 따라 오류 메시지나 로딩 화면을 출력하는데 이런 화면들은 화면 1개당 최소 2개의 화면을 구성해야 함. 예를 들어 오류가 있거나 없을 때 서로 다른 화면을 보여주어야 하므로 최소 2가지의 화면을 구성해야 함. 이처럼 상황에 맞게 컴포넌트를 제작하고 확인하는 작업은 번거로움

그래서 스토리북(react-storybook)이라는 비주얼 테스트를 위한 도구를 사용하는데 비주얼 테스트란 화면을 구성하는 컴포넌트들을 독립적으로 관리하고 변화를 살펴볼 수 있는 방법을 의미. 실제 가구를 집에 배치하기 전에 제품 사진만 따로 모아둔 책자에서 다양한 색상의 가구를 확인하는 것과 비슷함. 

### 스토리북 설치하고 사용해 보기

#### 1. 스토리북 설치하기

프로젝트의 루트폴더로 이동하여 다음 명령어를 실행하면 package.json에 자동으로 스토리북이 추가된 것을 확인 가능

```bash
$ yarn add --dev @storybook/react
```

#### 2. package.json에 스토리북 실행 명령어 추가하기

설치가 완료된 스토리북을 실행하기 위해서 package.json에 노드 명령어를 추가함. 
package.json의 scripts 블록은 npm 또는 yarn에서 실행할 명령어를 정의하는 곳이며 지금까지 리액트 서버를 구동시킬 때 사용한 yarn start라는 명령어도 이 블록의 명령어를 참조한 것

+ storybook 명령어가 스토리북 서버를 9001 포트를 통해 실행시킬 수 있도록 설정

  ```json
  // ./package.json
  
  ...
    "scripts": {
      "storybook": "start-storybook -p 9001 -c .storybook",
      "start": "react-scripts start",
      "build": "react-scripts build",
      "test": "react-scripts test",
      "eject": "react-scripts eject"
    },
  ...
  ```

#### 3. 스토리 파일 만들기

스토리는 컴포넌트의 여러 출력 형태를 구성한 페이지인데 여기서는 다양한 형태의 Input 컴포넌트를 가지는 Input 스토리를 만들어봄. 

+ ./src에 stories 폴더를 생성 후 InputStory.jsx 파일을 생성

  ```jsx
  // ./src/stories/InputStory.jsx
  
  import React from "react";
  import { storiesOf } from "@storybook/react";
  
  import Input from "../03/Input";
  
  storiesOf("Input", module).add("기본 설정", () => <Input />);
  ```

#### 4. 스토리북 config.js에 스토리 연결하기

만든 스토리 파일을 스토리북 config.js에 연결하려면 루트 폴더에 `.storybook`이라는 이름의 폴더가 필요.

+ .storybook 폴더 생성 후 config.js 파일 생성

  ```jsx
  // ./.storybook/config.js
  
  import { configure } from "@storybook/react";
  
  function loadStories() {
    require("../src/stories/InputStory");
    // 스토리 파일을 이곳에 추가할 수 있음
  }
  
  configure(loadStories, module);
  ```

#### 5. 스토리북 실행하기

터미널에서 다음과 같은 명령어 실행 

```bash
$ yarn storybook
```

명령어 실행이 완료되면 명령 프롬프트에 'Storybook 5.2.0 started...'와 같은 메시지가 출력되며, localhost:9001에서 자동으로 접속

#### 6. 스토리북 오류 메시지 수정하기

크롬 브라우저의 콘솔창을 보면 Input 컴포넌트의 필수 프로퍼티인 name이 없다는 오류 메시지가 나타나는데(Input 프로퍼티에서 프로퍼티 name을 isRequired로 정의), Input 스토리에서 add() 함수로 추가한 Input 컴포넌트에 name 프로퍼티를 추가하면 오류 메시지가 사라짐

+ ./src/stories/InputStory.jsx 수정

  ```jsx
  // ./src/stories/InputStory.jsx
  
  import React from 'react';
  import { storiesOf } from '@storybook/react';
  
  import Input from '../03/Input';
  
  storiesOf('Input', module).add('기본 설정', () => <Input name="name" />);
  ```

여기까지 진행하면 스토리북의 모든 설정 작업이 완료된 것

참조: [https://storybook.js.org/basics/guide-react/](https://storybook.js.org/basics/guide-react/)

<br>

### 스토리북 사용하기

스토리에 여러 형태의 컴포넌트를 추가하고, 새 스토리를 자동으로 스토리북에 연결

#### 1. 스토리에 다른 형태의 컴포넌트 추가하기

라벨이 있는 형태의 Input 컴포넌트를 Input 스토리에 추가

+ ./src/stories/InputStory.jsx 수정

  ```jsx
  // ./src/stories/InputStory.jsx
  
  import React from 'react';
  import { storiesOf } from '@storybook/react';
  
  import Input from '../03/Input';
  
  storiesOf('Input', module)
    .add('기본 설정', () => <Input name="name" />)
    .add('label 예제', () => <Input name="name" label="이름" />);
  ```

수정 후 저장하면 크롬 브라우저가 자동으로 새로고침되며 왼쪽 메뉴에 'label 예제' 컴포넌트가 추가

스토리에 여러 형태의 Input 컴포넌트를 추가할 수 있으므로 Input 컴포넌트가 포함된 실제 리액트 앱 화면을 직접 수정하여 확인하는 과정은 스토리북에서 하면 됨. 즉, 컴포넌트에 다양한 기능이나 디자인을 추가할 때는 스토리북을 사용

#### 2. 스토리 추가하기

새 스토리 추가

+ ./src/stories에 NewCounterStory.jsx 생성

  ```jsx
  // ./src/stories/NewCounterStory.jsx
  
  import React from 'react';
  import { storiesOf } from '@storybook/react';
  
  import NewCounter from '../03/NEwCounter';
  
  storiesOf('NewCounter', module).add('기본 설정', () => <NewCounter count={0} />);
  ```

#### 3. 스토리북에 스토리 추가하기

+ ./.storybook/config.js 수정

  ```jsx
  // ./.storybook/config.js
  
  import { configure } from '@storybook/react';
  
  function loadStories() {
    require('../src/stories/InputStory');
    // 스토리 파일을 이곳에 추가할 수 있음
    require('../src/stories/NewCounterStory');
  }
  
  configure(loadStories, module);
  ```

####  4. 스토리가 자동으로 스토리북에 추가되도록 config.js 설정하기

아래와 같이 수정하면 stories 폴더에 있는 파일 이름을 검사하여 '~Story.jsx'라고 끝나는 이름의 파일들을 config.js에 자동으로 추가 가능

+ ./.storybook/config.js 수정

  ```jsx
  import { configure } from '@storybook/react';
  import interopRequireDefault from 'babel-runtime/helpers/interopRequireDefault';
  
  function loadStories() {
    const context = require.context('../src/stories', true, /Story\.jsx$/);
    context.keys().forEach((srcFile) => {
      interopRequireDefault(context(srcFile));
    });
  }
  
  configure(loadStories, module);
  ```

#### 5. 스토리가 자동으로 스토리북에 추가되는지 확인해 보기

+ ./src/stories에 BooleanComponentStory.jsx 생성

  ```jsx
  import React from 'react';
  import { storiesOf } from '@storybook/react';
  
  import BooleanComponent from '../03/BooleanComponent';
  
  storiesOf('BooleanComponent', module)
    .add('기본 설정', () => <BooleanComponent />)
    .add('bored 설정', () => <BooleanComponent bored />);
  ```

<br>

### 스토리북 확장 도구 사용하기

스토리북에는 여러가지 확장 도구(addons)를 추가 가능

이벤트 작동 테스트와 컴포넌트 사용 코드를 출력하기 위한 확장 도구인 addon-action과 addon-jsx를 설치 및 사용

#### 1. addon-actions 설치하기

addon-actions은 스토리북에서 발생하는 특정 이벤트에 로그를 출력하게 해줌

```bash
$ yarn add --dev @storybook/addons @storybook/addon-actions
```

#### 2. addon-actions 설정 추가하기

설치가 완료되면 확장 도구를 스토리북이 인식할 수 있도록 설정

+ ./.storybook에 addons.js 생성

  ```jsx
  // 확장 도구는 이곳에 설치
  import '@storybook/addon-actions/register';
  ```

#### 3. InputStory 스토리에 addon-actions 적용하기

스토리에 'onChange 예제'라는 항목을 추가하는데 이 컴포넌트는 변경 이벤트가 발생하면 onChange 프로퍼티에 전달한 콜백 함수를 실행

+ ./src/stories/InputStory.jsx 수정

  ```jsx
  // ./src/stories/InputStory.jsx
  
  import React from 'react';
  import { storiesOf } from '@storybook/react';
  import { action } from '@storybook/addon-actions';
  
  import Input from '../03/Input';
  
  storiesOf('Input', module)
    .add('기본 설정', () => <Input name="name" />)
    .add('label 예제', () => <Input name="name" label="이름" />)
    .add('onChange 예제', () => <Input name="name" onChange={action('onChange 이벤트 발생')} />);
  ```

#### 4. 스토리북 다시 시작하고 onChange 예제 살펴보기

스토리북에는 스토리 또는 스토리에 추가한 컴포넌트들을 검색 가능한 창이 있으며 검색창에 'onChange'를 입력하면 'onChange 예제' 항목을 쉽게 찾을 수 있음

#### 5. 로그 확인

입력창에 아무 내용이나 입력하면 아래의 [ACTION LOGGER] 탭에 로그가 출력
action() 함수의 인자로 전달된 문자열과 콜백 함수에서 전달된 인자가 배열 형태로 출력되는 것을 확인

#### 6. addon-jsx 설치하기

addon-jsx는 스토리북에서 바로 JSX 코드를 확인 가능하도록 해줌

```bash
$ yarn add --dev storybook-addon-jsx
```

#### 7. addon-jsx 설정 추가하기

+ ./.storybook/addons.js 수정

  ```jsx
  // ./.storybook/addons.js
  
  // 확장 도구는 이곳에 설치
  import '@storybook/addon-actions/register';
  import 'storybook-addon-jsx/register';
  ```

+ ./.storybook/config.js 수정

  ```jsx
  // ./storybook/config.js
  
  import { configure, setAddon } from '@storybook/react';
  import interopRequireDefault from 'babel-runtime/helpers/interopRequireDefault';
  import JSXAddon from 'storybook-addon-jsx';
  
  function loadStories() {
    const context = require.context('../src/stories', true, /Story\.jsx$/);
    context.keys().forEach((srcFile) => {
      interopRequireDefault(context(srcFile));
    });
  }
  
  setAddon(JSXAddon);
  configure(loadStories, module);
  ```

#### 8. 스토리북 다시 시작하고 addon-jsx 사용해 보기

스토리북 서버를 다시 구동하면 JSX라는 탭이 보이는데 addon-jsx를 통해 JSX를 보내려면 add() 함수가 아닌 addWithJSX() 함수를 사용하여 스토리에 컴포넌트를 추가해야 함

+ ./src/stories/InputStory.jsx 수정

  ```jsx
  // ./src/stories/InputStory.jsx
  
  import React from 'react';
  import { storiesOf } from '@storybook/react';
  import { action } from '@storybook/addon-actions';
  
  import Input from '../03/Input';
  
  storiesOf('Input', module)
    .addWithJSX('기본 설정', () => <Input name="name" />)
    .addWithJSX('label 예제', () => <Input name="name" label="이름" />)
    .addWithJSX('onChange 예제', () => (
      <Input name="name" onChange={action('onChange 이벤트 발생')} />
    ));
  ```

  