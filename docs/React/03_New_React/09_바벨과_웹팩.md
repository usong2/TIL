## 바벨과 웹팩 자세히 들여다보기

바벨(babel)과 웹팩(webpack)은 웹 애플리케이션을 제작할 때 없어서는 안되는 기반 기술이 되었다. 리액트 또는 뷰(vue)를 기반으로 프로젝트를 구축해 주는 create-react-app, next.js, vue-cli, nuxt 등의 도구는 바벨과 웹팩을 기본적으로 포함한다.

물론 도구의 도움을 받아서 자동으로 프로젝트를 구축하면 바벨과 웹팩을 모르더라도 간단한 웹 애플리케이션을 제작할 수 있다. 리액트와 뷰를 처음 배우는 단계에서는 바벨과 웹팩을 모르는 편이 나을 수도 있다. 하지만 프로젝트의 규모가 점점 커지는 상황에서 바벨과 웹팩을 계속해서 외면하기는 힘들다. 제스트(jest)와 같은 테스트 프레임워크를 도입할 때, 스토리북(storybook)과 같이 별도의 빌드 과정이 필요할 때, 서버사이드 렌더링을 위해서 서버 측 코드를 빌드해야 할 때 등 바벨과 웹팩을 이해해야만 하는 순간이 반드시 온다.

바벨과 웹팩의 주요 개념과 기본적인 사용법을 설명한다. 그리고 바벨의 플러그인, 웹팩의 로더와 플러그인을 직접 제작해 보면서 바벨과 웹팩의 내부 동작에 대한 이해를 돕는다.

### 바벨 실행 및 설정하기

리액트로 개발을 하다 보면 개발자 대부분이 바벨 설정 때문에 애를 먹는다. 바벨을 제대로 이해하지 못하면 인터넷에 떠도는 바벨 설정을 무분별하게 가져오기 쉽다. 그렇게 가져온 설정으로 한동안은 잘 돌아가는 듯 보이지만 예상치 못한 상황에서 문제가 발생하기 마련이다. 여기서는 바벨을 설정하는 여러 가지 방법을 알아보고, 각자의 프로젝트에 적합한 설정을 무엇인지 고민해 보자. 

또한 폴리필은 무엇이고 바벨에서 어떻게 설정하는지 알아보기로 한다. 바벨과 폴리필의 관계를 이해하지 못하면 오래된 브라우저에서 에러가 발생하는 코드가 만들어질 수 있다. core-js 패키지와 @babel/preset-env 프리셋을 통해 폴리필을 관리하는 방법을 알아보자. 

#### 바벨을 실행하는 여러 가지 방법

바벨은 다음과 같이 다양한 방식으로 실행될 수 있다.

+ @babel/cli로 실행하기
+ 웹팩에서 babel-loader로 실행하기
+ @babel/core를 직접 실행하기
+ @babel/register로 실행하기

@babel/register를 이용하면 노드(Node.js)에서 require 코드가 실행될 때 동적으로 바벨이 실행되게 할 수 있다. 리액트를 @babel/register와 함께 사용하는 경우는 많지 않으므로 @babel/register를 제외한 나머지 세 방식을 설명한다. 

> **바벨이란?**
>
> 바벨은 입력과 출력이 모두 자바스크립트 코드인 컴파일러다. 이는 보통의 컴파일러가 고수준의 언어를 저수준의 언어로 변환하는 것과 비교된다.
>
> 초기의 바벨은 ES6 코드를 ES5 코드로 변환해 주는 컴파일러였다. 현재는 바벨을 이용해서 리액트으 JSX 문법, 타입스크립트와 같은 정적 타입 언어, 코드 압축, 제안(proposal) 단계에 있는 문법 등을 사용할 수 있다.

실습을 위한 프로젝트를 생성해 보자.

```bash
$ mkdir test-babel-how
$ cd test-babel-how
$ npm init -y
```

먼저 필요한 패키지를 설치하자.

```bash
$ npm install @babel/core @babel/cli @babel/plugin-transform-arrow-functions @babel/plugin-transform-template-literals @babel/preset-react
```

바벨을 실행하기 위해서는 @babel/core 패키지를 필수로 설치해야 한다. 두 개의 플러그인과 프리셋 하나를 추가로 설치했다. 

이제 컴파일할 코드를 작성해 보자. 프로젝트 루트에 src 폴더를 만들고 그 밑에 code.js 파일을 만들자. code.js 파일의 내용은 다음과 같다.

```jsx
const element = <div>babel test</div>;
const text = `element type is ${element.type}`;
const add = (a, b) => a + b;
```

1행은 리액트 프리셋을 이용해서 JSX 문법을 변환할 예정이다. 2행은 템플릿 리터럴 플러그인을 이용해서 템플릿 리터럴 코드를 변환할 예정이다. 3행은 화삺 ㅛ함수 플러그인을 사용해서 화살표 함수를 변환할 예정이다. 

