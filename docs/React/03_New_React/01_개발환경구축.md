## 개발환경구축

리액트는 UI 라이브러리이기 때문에 UI를 제외한 나머지 요소들은 개발자가 신경 써서 관리해야 한다. 하나의 웹 애플리케이션을 만들기 위해서는 테스트 시스템, 빌드 시스템, 라우팅 시스템 등 UI 외에도 신경 써야 할 부분이 많다. 

그러므로 리액트 개발 환경을 직접 구축하기보다는 create-react-app과 같은 도구를 사용할 것을 추천한다. 하지만 리액트 웹 애플리케이션의 툴체인(toolchain)을 이해하기 위해서는 한 번쯤 직접 구축해보는 것도 좋다. 개발 환경을 직접 구축하면서 바벨과 웹팩의 필요성을 알아보자. 

### Hello World 페이지 만들기

리액트로 웹 애플리케이션을 제작할 때는 다양한 외부 패키지를 활용하는게 일반적이다. 하지만 이런 다양한 외부 패키지의 존재는 처음 리액트를 접하는 사람에게 오히려 큰 부담이 된다. 사용자는 외부 패키지가 너무 많아서 각 패키지의 용도도 모르는 경우가 많다.

 외부패키지를 전혀 사용하지 않고 리액트로 간단한 웹 페이지를 만들기 위해 다음 경로에서 리액트 자바스크립트 파일 4개를 내려받는다. 

1. [https://unpkg.com/react@16/umd/react.development.js](https://unpkg.com/react@16/umd/react.development.js)
2. [https://unpkg.com/react@16/umd/react.production.min.js](https://unpkg.com/react@16/umd/react.production.min.js)
3. [https://unpkg.com/react-dom@16/umd/react-dom.development.js](https://unpkg.com/react-dom@16/umd/react-dom.development.js)
4. [https://unpkg.com/react-dom@16/umd/react-dom.production.min.js](https://unpkg.com/react-dom@16/umd/react-dom.production.min.js)

1,3은 개발 환경에서 사용되는 파일이고 2,4는 배포 환경에서 사용되는 파일이다. 개발 환경을 위한 파일을 사용하면 개발 시 도움이 되는 에러 메시지를 확인할 수 있다. 1,2 파일은 플랫폼 구분 없이 공통으로 사용되는 리액트의 핵심 기능을 담고 있다. 따라서 웹 뿐만 아니라 리액트 네이티브(react-native)에서도 사용된다. 3,4는 웹에서만 사용되는 파일이다. 

이제 리액트 패키지만 사용해서 간단한 웹 어플리케이션을 만들어 보자. hello-world라는 폴더를 만든 다음, 앞에서 언급한 네 개의 파일을 넣는다. 그리고 같은 폴더에 내용이 없는 simple1.html, simple1.js 두 파일을 만든다. 

```
hello-world
├── react.development.js
├── react.production.min.js
├── react-dom.development.js
├── react-dom.production.min.js
├── simple1.html
└── simple1.js
```

simple1.html 파일에는 필요한 자바스크립트 파일과 리액트에서 사용할 돔 요소를 정의한다. simple1.html 파일에는 다음 내용을 입력하자. 

```html
<!-- simple1.html -->

<html>
    <body>
        <h2>안녕하세요. 이 프로젝트가 마음에 드시면 좋아요 버튼을 눌러 주세요.</h2>
        <div id="react-root"></div>
        <script src="react.development.js"></script>
        <script src="react-dom.development.js"></script>
        <script src="simple1.js"></script>
    </body>
</html>
```

simple1.js 파일에는 좋아요 버튼을 보여 주는 리액트 컴포넌트를 작성해 보자. 버튼을 누르면 좋아요 취소 문구를 보여준다. 

```js
// simple1.js

function LikeButton() {
    const [liked, setLiked] = React.useState(false);
    const text = liked ? '좋아요 취소' : '좋아요';
    return React.createElement(
    	'button',
        { onClick: () => setLiked(!liked) },
        text,
    )
}
const domContainer = document.querySelector('#react-root');
ReactDOM.render(React.createElement(LikeButton), domContainer);
```

#### createElement 이해하기

createElement 함수의 구조는 다음과 같다. 

`React.createElement(component, props, ...children) => ReactElement`

첫 번째 매개변수 component는 일반적으로 문자열이나 리액트 컴포넌트다. component의 인수가 문자열이면 HTML 태그에 해당하는 돔 요소가 생성된다. 예를 들어, 문자열 p를 입력하면 HTML p 태그가 생성된다. 

두 번째 매개변수 props는 컴포넌트가 사용하는 데이터를 나타낸다. 돔 요소의 경우 style, className 등의 데이터가 사용될 수 있다. 

세 번째 매개변수 children은 해당 컴포넌트가 감싸고 있는 내부의 컴포넌트를 가리킨다. div 태그가 두 개의 p 태그를 감싸고 있는 경우에 다음과 같이 작성할 수 있다. 

```html
<div>
    <p>hello</p>
    <p>world</p>
</div>
```

```jsx
createElement(
	'div',
    null,
    createElement('p', null, 'hello'),
    createElement('p', null, 'world'),
)
```

대부분의 리액트 개발자는 createElement를 직접 작성하지 않는다. 일반적으로 바벨(babel)의 도움을 받아서 JSX 문법을 사용한다. 

#### 여러 개의 돔 요소에 렌더링하기

리액트가 돔 요소의 한 곳에만 렌더링할 수 있는 것은 아니다.
코드를 조금 수정해서 돔 요소 세 군데에 좋아요 버튼을 렌더링해 보자. 

```html
<!-- simple2.html -->

<html>
  <body>
    <h2>안녕하세요. 이 프로젝트가 마음에 드시면 좋아요 버튼을 눌러 주세요.</h2>
    <div id="react-root1"></div>
    <div id="react-root2"></div>
    <div id="react-root3"></div>
    <script src="react.development.js"></script>
    <script src="react-dom.development.js"></script>
    <script src="simple1.js"></script>
  </body>
</html>
```

```js
// simple2.js

function LikeButton() {
  const [liked, setLiked] = React.useState(false);
  const text = liked ? "좋아요 취소" : "좋아요";
  return React.createElement(
    "button",
    { onClick: () => setLiked(!liked) },
    text
  );
}
ReactDOM.render(
  React.createElement(LikeButton),
  document.querySelector("#react-root1")
);
ReactDOM.render(
  React.createElement(LikeButton),
  document.querySelector("#react-root2")
);
ReactDOM.render(
  React.createElement(LikeButton),
  document.querySelector("#react-root3")
);
```

### 바벨 사용해 보기

바벨(babel)은 자바스크립트 코드를 변환해 주는 컴파일러다. 바벨을 사용하면 최신 자바스크립트 문법을 지원하지 않는 환경에서도 최신 문법을 사용할 수 있다. ES6가 막 나왔을 때는 대부분의 브라우저가 ES5만 지원하고 있었기 때문에 ES6 문법을 사용할 수 없었다. 그때 바벨(당시 이름은 6to5)이 ES6 문법으로 작성된 자바스크립트 코드를 ES5 문법으로 변환해 줬다. ES6 문법을 사용하고 싶어 하는 개발자가 많았기 때문에 바벨의 인기도가 높아졌다. 

바벨은 자바스크립트 최신 문법을 사용하는 용도 외에도 다양하게 활용될 수 있다. 이를테면, 코드에서 주석을 제거하거나 코드를 압축하는 용도로 사용될 수 있다. 리액트에서는 JSX 문법을 사용하기 위해 바벨을 사용한다. 바벨이 JSX 문법으로 작성된 코드를 createElement 함수를 호출하는 코드로 변환해 준다. 

우리는 지금까지 외부 패키지 없이 리액트 웹사이트를 만들었다. 여기서는 최초의 외부 패키지로 바벨을 추가해 보려고 한다. 현재까지의 코드는 너무 단순하므로 그 전에 몇 가지 컴포넌트를 먼저 추가해 보겠다. 

화면에 count 상탯값을 보여 주고 증가, 감소 버튼을 통해서 count 상탯값을 변경하는 코드를 작성해 보자. 먼저 simple1.html, simple1.js 파일을 복사해서 simple3.html, simple3.js 파일을 만들고, simple3.html에 있는 simple1.js 문자열을 simple3.js로 변경하자. 그리고 simple3.js 파일에 있는 Container 컴포넌트를 추가해 보자.

```js
// simple3.js

function LikeButton() {
  const [liked, setLiked] = React.useState(false);
  const text = liked ? "좋아요 취소" : "좋아요";
  return React.createElement(
    "button",
    { onClick: () => setLiked(!liked) },
    text
  );
}

function Container() {
  const [count, setCount] = React.useState(0);
  return React.createElement(
    "div",
    null,
    React.createElement(LikeButton),
    React.createElement(
      "div",
      { style: { marginTop: 20 } },
      React.createElement("span", null, "현재 카운트: "),
      React.createElement("span", null, count),
      React.createElement(
        "button",
        { onClick: () => setCount(count + 1) },
        "증가"
      ),
      React.createElement(
        "button",
        {
          onClick: () => SpeechRecognitionResult(count - 1),
        },
        "감소"
      )
    )
  );
}

const domContainer = document.querySelector("#react-root");
ReactDOM.render(React.createElement(Container), domContainer);
```

### JSX 문법 사용해 보기

Container 컴포넌트 코드는 JSX 문법을 사용하면 가독성이 좋아진다.  simple3.html 파일을 복사해서 simple4.html 파일을 만들자. 
simple4.html에 있는 simple3.js 문자열을 simple4.js로 변경하고, hello-world 폴더 밑에 src 폴더를 만든다. 그 다음 simple3.js 파일을 복사해서 src 폴더 밑에 simple4.js 파일을 만든다. 여기까지 따라 했다면 다음과 같은 구조가 된다. 

```bash
hello-world
├── react.development.js
├── react.production.min.js
├── react-dom.development.js
├── react-dom.production.min.js
├── simple4.html
└── src
    └── simple4.js
```

이제 createElement 함수를 호출하는 코드를 JSX 문법으로 변경해 보자. 
simple4.js 파일에서 Container 컴포넌트를 다음과 같이 변경한다. 

```jsx
function Container() {
  const [count, setCount] = React.useState(0);
  return (
    <div>
      <LinkButton />
      <div style={{ marginTop: 20 }}>
        <span>현재 카운트</span>
        <span>{count}</span>
        <button onClick={() => setCount(count + 1)}>증가</button>
        <button onClick={() => setCount(count - 1)}>감소</button>
      </div>
    </div>
  );
}
```

JSX는 HTML에서 태그를 사용하는 방식과 유사하다. createElement 함수를 사용해서 작성하는 것보다는 JSX 문법을 사용하는 게 간결하고 가독성도 좋다. HTML 태그와의 가장 큰 차이는 속성값을 작성하는 방법에 있다. 

```jsx
<div className="box">
	<Title text="hello world" width={200} />
    <button onClick={() => {}}>좋아요</button>
    <a href="/home" style={{ marginTop: '10px', color: 'red' }}>
    	홈으로 이동
    </a>
</div>
```

#### JSX 문법을 바벨로 컴파일하기

JSX 문법은 자바스크립트 표준이 아니기 때문에 simple4.js 파일을 그대로 실행하면 에러가 발생한다. 바벨을 이용해서 JSX 문법으로 작성된 simple4.js 파일을 createElement 함수로 작성된 파일을 변환해 보자. 파일을 변환하기 위해서는 먼저 다음 패키지를 설치해야 한다. 

```bash
$ npm install @babel/core @babel/cli @babel/preset-react
```

@babel/cli에는 커맨드 라인에서 바벨을 실행할 수 있는 바이너리 파일이 들어 있다. @babel/preset-react에는 JSX로 작성된 코드를 createElement 함수를 이용한 코드로 변환해 주는 바벨 플러그인이 들어 있다. 

> ##### 바벨 플러그인과 프리셋
>
> 바벨은 자바스크립트 파일을 입력으로 받아서 또 다른 자바스크립트 파일을 출력으로 준다. 이렇게 자바스크립트 파일을 변환해 주는 작업은 플러그인(plugin) 단위로 이루어진다. 두 번의 변환이 필요하다면 두 개의 플러그인을 사용한다. 하나의 목적을 위해 여러 개의 플러그인이 필요할 수 있는데, 이러한 플러그인의 집합을 프리셋(preset)이라고 한다. 예를 들어, 바벨에서는 자바스크립트 코드를 압축하는 플러그인을 모아 놓은 babel-preset-minify 프리셋을 제공한다. @babel/preset-react는 리액트 애플리케이션을 만들 때 필요한 플러그인을 모아 놓은 프리셋이다. 

설치된 패키지를 이용해서 자바스크립트 파일을 변환해 보자. 

```bash
$ npx babel --watch src --out-dir . --presets @babel/preset-react
```

npx 명령어는 외부 패키지에 포함된 실행 파일을 실행할 때 사용된다. 외부 패키지의 실행 파일은 ./node_modules/.bin/ 밑에 저장된다. 따라서 npx babel은 ./node_modules/.bin/babl을 입력하는 것과 비슷하다. 오래된 npm 버전에서는 npx 명령어가 동작하지 않으므로, 최신 버전의 npm을 설치하거나 ./node_modules/.bin/babel을 입력하자. 

위 명령어를 실행하면 src 폴더에 있는 모든 자바스크립트 파일을 @babel/preset-react 프리셋을 이용해서 변환 후 현재 폴더에 같은 이름의 자바스크립트 파일을 생성한다. watch 모드로 실행했기 때문에 src 폴더의 자바스크립트 파일을 수정할 때마다 자동으로 변환 후 저장한다. 바벨로 변환 후 simple4.html을 실행해 보면 simple3.html과 같은 결과 화면을 볼 수 있다. 

